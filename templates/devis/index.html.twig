{# templates/devis.html.twig #}
{% extends 'base.html.twig' %}

{% block title %}Devis - Titus Animation{% endblock %}

{% block body %}
  {# On peut retirer le "min-h-screen" ici, l'essentiel est que <main> en base.html.twig ait déjà flex-grow #}
  <div class="flex flex-col flex-grow bg-white items-center justify-center py-12">
    <div class="w-full max-w-lg px-4">
      <h1 class="text-3xl font-bold text-center mb-8">Demande de devis</h1>
      <form action="#" method="post" class="space-y-6">
        {# --- Choix du type de devis (préréglé depuis la query string) --- #}
        <div>
          <label for="type_devis" class="block text-gray-800 font-medium">Type de devis</label>
          <select 
            name="type_devis" 
            id="type_devis" 
            class="mt-2 w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
          >
            <option value="sur_scene"       {{ app.request.get('type') == 'sur_scene'       ? 'selected' : '' }}>Sur scène</option>
            <option value="sculpture_fixe"  {{ app.request.get('type') == 'sculpture_fixe'  ? 'selected' : '' }}>Sculpture fixe</option>
            <option value="sculpture_mobile"{{ app.request.get('type') == 'sculpture_mobile'? 'selected' : '' }}>Sculpture mobile</option>
            <option value="decoration"      {{ app.request.get('type') == 'decoration'      ? 'selected' : '' }}>Décoration</option>
            <option value="conte_medieval"  {{ app.request.get('type') == 'conte_medieval'  ? 'selected' : '' }}>Conte (médiéval)</option>
          </select>
        </div>

        {# --- Champs communs --- #}
        <div>
          <label for="prenom" class="block text-gray-800 font-medium">Prénom</label>
          <input 
            type="text" 
            name="prenom" 
            id="prenom" 
            class="mt-2 w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
          >
        </div>
        <div>
          <label for="nom" class="block text-gray-800 font-medium">Nom</label>
          <input 
            type="text" 
            name="nom" 
            id="nom" 
            class="mt-2 w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
          >
        </div>
        <div>
          <label for="adresse" class="block text-gray-800 font-medium">Adresse</label>
          <input 
            type="text" 
            name="adresse" 
            id="adresse" 
            class="mt-2 w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
          >
        </div>
        <div>
          <label for="coordonnees" class="block text-gray-800 font-medium">Coordonnées (Téléphone, Mail)</label>
          <input 
            type="text" 
            name="coordonnees" 
            id="coordonnees" 
            class="mt-2 w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
          >
        </div>
        <div>
          <label for="lieu_animation" class="block text-gray-800 font-medium">Lieu de l’animation</label>
          <input 
            type="text" 
            name="lieu_animation" 
            id="lieu_animation" 
            class="mt-2 w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
          >
        </div>
        <div>
          <label for="date" class="block text-gray-800 font-medium">Date</label>
          <input 
            type="date" 
            name="date" 
            id="date" 
            class="mt-2 w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
          >
        </div>
        <div>
          <label for="heure" class="block text-gray-800 font-medium">Heure</label>
          <input 
            type="time" 
            name="heure" 
            id="heure" 
            class="mt-2 w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
          >
        </div>
        <div>
          <label for="contact_jour_j" class="block text-gray-800 font-medium">Contact pour le jour J</label>
          <input 
            type="text" 
            name="contact_jour_j" 
            id="contact_jour_j" 
            class="mt-2 w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
          >
        </div>

        {# --- Champs conditionnels : Espace scénique (Sur scène + Conte) --- #}
        <div id="champs_espace_scene" class="hidden">
          <label for="espace_scene" class="block text-gray-800 font-medium">Espace scénique</label>
          <input 
            type="text" 
            name="espace_scene" 
            id="espace_scene" 
            class="mt-2 w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
          >
        </div>

        {# --- Champs conditionnels : Durée (Sculpture fixe + Sculpture mobile) --- #}
        <div id="champs_duree" class="hidden">
          <label for="duree" class="block text-gray-800 font-medium">Durée</label>
          <input 
            type="text" 
            name="duree" 
            id="duree" 
            class="mt-2 w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
          >
        </div>

        <div>
          <label for="infos_complementaires" class="block text-gray-800 font-medium">Informations complémentaires</label>
          <textarea 
            name="infos_complementaires" 
            id="infos_complementaires" 
            class="mt-2 w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
          ></textarea>
        </div>

        <button 
          type="submit" 
          class="w-full py-3 bg-blue-600 text-white font-bold rounded hover:bg-blue-700 transition"
        >
          Envoyer
        </button>
      </form>
    </div>
  </div>

  <script>
    function updateConditionalFields() {
      var type = document.getElementById('type_devis').value;
      // Masquer les deux blocs d’abord
      document.getElementById('champs_espace_scene').classList.add('hidden');
      document.getElementById('champs_duree').classList.add('hidden');

      // Afficher le bloc “Espace scénique” si Sur scène ou Conte (médiéval)
      if (type === 'sur_scene' || type === 'conte_medieval') {
        document.getElementById('champs_espace_scene').classList.remove('hidden');
      }
      // Afficher le bloc “Durée” si Sculpture fixe ou Sculpture mobile
      else if (type === 'sculpture_fixe' || type === 'sculpture_mobile') {
        document.getElementById('champs_duree').classList.remove('hidden');
      }
      // Pour “décoration”, ni espace_scene ni durée n’apparaissent
    }

    // Met à jour à chaque changement de sélection
    document.getElementById('type_devis').addEventListener('change', updateConditionalFields);
    // Au chargement de la page, on appelle l’update pour afficher dès le départ le bon bloc
    updateConditionalFields();
  </script>
{% endblock %}
